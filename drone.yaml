---
kind: pipeline
type: docker
name: default

steps:
- name: send-api-request
  image: curlimages/curl:latest
  environment:
    DIGITALOCEAN_TOKEN:
      from_secret: digitalocean_token
  curl_job:
    variables:
        REQUEST_BODY: '{"name":"My SSH Public Key","public_key":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCLIOXe/rYLQdLreZ2zzPincoykqpgFnoCV2oml0/eH5Y1uCByTEA8FUJyaQFfNPy0EQGgYRfZDedinA9hs1SLtyeJKmA8FyaW1AoDun8zGUvBgxUcYpIWKUi5Fl33L4rQZG05jtQpAcWtTSe/udsNllcrblRaLAXVaTgy3Fxuan8LhOqkXcvW8ZXYICDVYZGhVPbnsec+/cRLCkqQE1UrLL+tDvVqOfbKGbE3UPxemGAAEnZYdn/asF+uBDYN2uIUmjMJIrWCHuwtBQnjebMurNO4JtQkeAIWrYPn9rnKk+HW2PdkvNPMP4oH0FIkWLL5A/TkUMjgv78T3pPQjDWjr rsa-key-20241231 example"}'
    commands: >
        curl -X POST "https://api.digitalocean.com/v2/account/keys"
        -H "Content-Type: application/json"
        -H "Authorization: Bearer $DIGITALOCEAN_TOKEN" 
        -d "${REQUEST_BODY}"

    
    


# ---
# kind: pipeline
# type: digitalocean
# name: Building docker image for nodejs

# token:
#     from_secret: token

# server:
#     image: ubuntu-24-10-x64
#     size: s-1vcpu-512mb-10gb
#     region: sfo3
# # pipeline start here
# steps:
#     - name: cloneing the git repo
#       commands:
#           - git clone https://github.com/RohitDarekar816/sample-nodejs.git

#     - name: Installing the docker
#       commands:
#           - sudo apt install docker.io -y

#     - name: Building docker image
#       commands:
#           - docker build -t sample-nodejs .

#     - name: login to digitalocean via api token
#       environment:
#           DO_USERNAME:
#               from_secret: DO_USERNAME
#           DO_API_TOKEN:
#               from_secret: token
#       commands:
#           - echo $DO_API_TOKEN | docker login registry.digitalocean.com --username $DO_USERNAME --password-stdin
#           - docker tag sample-nodejs registry.digitalocean.com/pipelineaws/sample-nodejs
#           - docker push registry.digitalocean.com/pipelineaws/sample-nodejs

trigger:
    event:
        - push
        - pull_request
    branch:
        - main
